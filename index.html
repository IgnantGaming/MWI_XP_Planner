<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <title>MWI XP Planner ‚Äî Primary & Charm (Target-Aware)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script defer src="app.js"></script>
</head>
<body>
  <div class="row header">
    <div>
      <h1>MWI XP Planner ‚Äî Primary & Charm</h1>
      <p class="muted small">
        Enter your Primary and Charm info separately (level, XP needed, XP/hour).
        ‚ÄúTarget Applies To‚Äù decides which side‚Äôs goal sets the cross-projection.<br>
        <a href="https://greasyfork.org/en/scripts/555252-mwi-xp-planner">MWI-XP-Planner</a> Add the Tamper Monkey script for easier Imports.
      </p>
      <a href="https://greasyfork.org/en/scripts/555252-mwi-xp-planner" target="_blank" rel="noopener noreferrer" class="small muted" style="display:inline-block;margin-top:4px;">Install userscript for easier imports</a>
    </div>
    <button id="themeBtn" class="theme-toggle" title="Toggle theme">üåô Dark</button>
  </div>

  <!-- Imported skills (from Tampermonkey or bookmarklet via #cs=...) -->
  <div class="card" id="skillsCard" style="display:none;">
    <div class="row" style="justify-content:space-between;align-items:center;">
      <div>
        <div class="out"><strong>Player Skills (imported)</strong></div>
        <div class="small muted" id="skillsMeta"></div>
      </div>
      <div class="row small muted">
        <span id="skillsStatus"></span>
      </div>
    </div>
    <div class="table-wrap">
      <table class="grid-table" id="skillsTable" aria-label="Imported combat skills">
        <thead>
          <tr>
            <th>Skill</th>
            <th style="text-align:right;">Level</th>
            <th style="text-align:right;">Total XP</th>
            <th style="text-align:right;">XP to Next</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- CORS-safe local file fallback -->
  <div id="fileBanner" class="banner">
    <strong>Local file mode:</strong> Your browser blocked <code>fetch()</code> for <code>experience.json</code>.
    Choose the file manually: <input id="fileInput" type="file" accept="application/json,.json" />
    <span id="fileStatus" class="muted" style="margin-left:.5rem;"></span>
  </div>

  <!-- Primary / Charm inputs -->
  <div class="card two-col">
    <div id="primaryPanel">
      <div class="section-title">Primary
        <button id="primaryImportBtn" style="margin-left:.5rem;" title="Fill from imported skills">Autofill from imported</button>
      </div>
      <div class="grid">
        <div>
          <label for="primaryType">Class</label>
          <select id="primaryType">
            <option>Magic</option>
            <option>Melee</option>
            <option>Range</option>
          </select>
        </div>
        <div>
          <label for="primaryLevel">Current Level</label>
          <input id="primaryLevel" type="number" min="1" step="1" value="1" />
        </div>
        <div>
          <label for="primaryRemaining">XP Needed to Next Level</label>
          <input id="primaryRemaining" type="number" min="0" step="1" value="0" />
        </div>
        <div>
          <label for="primaryRate">XP per Hour (Primary)</label>
          <input id="primaryRate" type="number" min="0" step="1" value="1" />
        </div>
      </div>
    </div>

    <div id="charmPanel">
      <div class="section-title">Charm
        <button id="charmImportBtn" style="margin-left:.5rem;" title="Fill from imported skills">Autofill from imported</button>
      </div>
      <div class="grid">
        <div>
          <label for="charmType">Charm</label>
          <select id="charmType">
            <option>Attack</option>
            <option>Defense</option>
            <option>Intelligence</option>
            <option>Stamina</option>
          </select>
        </div>
        <div>
          <label for="charmLevel">Current Level</label>
          <input id="charmLevel" type="number" min="1" step="1" value="1" />
        </div>
        <div>
          <label for="charmRemaining">XP Needed to Next Level</label>
          <input id="charmRemaining" type="number" min="0" step="1" value="0" />
        </div>
        <div>
          <label for="charmRate">XP per Hour (Charm)</label>
          <input id="charmRate" type="number" min="0" step="1" value="0" />
        </div>
      </div>
    </div>
  </div>

  <!-- Global controls -->
  <div class="card">
    <div class="grid">
      <div>
        <label for="simHours">Simulate Hours</label>
        <input id="simHours" type="number" min="0" step="0.1" value="24" />
      </div>
      <div>
        <label for="targetLevel">Target Level</label>
        <input id="targetLevel" type="number" min="1" step="1" value="120" />
      </div>
      <div>
        <label for="targetApplies">Target Applies To</label>
        <select id="targetApplies">
          <option value="primary" selected>Primary</option>
          <option value="charm">Charm</option>
        </select>
      </div>
    </div>
    <div class="row" style="margin-top:.9rem;">
      <button class="primary-btn" id="calcBtn">Calculate</button>
      <button id="resetBtn">Reset</button>
      <span id="status" class="muted"></span>
    </div>
  </div>

  <!-- Outputs -->
  <div class="card two-col">
    <div>
      <div class="out"><strong>Primary ‚Äî Time to next level:</strong> <span id="p_timeNext">‚Äî</span></div>
      <div class="muted" id="p_details">Enter Primary rate and remaining XP.</div>
      <hr/>
      <div class="out"><strong>Primary ‚Äî Projection after <span id="p_hoursEcho">‚Äî</span> hours:</strong></div>
      <div class="muted" id="p_projection">Enter hours and click Calculate.</div>
      <hr/>
      <div class="out"><strong>Primary ‚Äî Time to Target:</strong> <span id="p_timeTarget">‚Äî</span></div>
      <div class="muted" id="p_targetDetails">Set Target Level and click Calculate.</div>
      <div class="muted" id="p_crossNote"></div>
    </div>
    <div>
      <div class="out"><strong>Charm ‚Äî Time to next level:</strong> <span id="c_timeNext">‚Äî</span></div>
      <div class="muted" id="c_details">Enter Charm rate and remaining XP.</div>
      <hr/>
      <div class="out"><strong>Charm ‚Äî Projection after <span id="c_hoursEcho">‚Äî</span> hours:</strong></div>
      <div class="muted" id="c_projection">Enter hours and click Calculate.</div>
      <hr/>
      <div class="out"><strong>Charm ‚Äî Time to Target:</strong> <span id="c_timeTarget">‚Äî</span></div>
      <div class="muted" id="c_targetDetails">Set Target Level and click Calculate.</div>
      <div class="muted" id="c_crossNote"></div>
    </div>
  </div>

  <div class="card">
    <div class="out"><strong>From table (<code>experience.json</code>):</strong></div>
    <div class="muted" id="tableInfo">Waiting for file load‚Ä¶</div>
  </div>
</body>
</html>
